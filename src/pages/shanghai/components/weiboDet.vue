<template>
  <div class="new-page" :style="`min-height: ${pageMinHeight}px`">
    <a-row :gutter="24" >
      <a-col :sm="24" :md="24" :xl="6" :style="{ marginBottom: '24px' }">
        <a-card title="åšæ–‡å†…å®¹" :bordered="false" :style="{ marginBottom: '24px',height:'300px'}">
          <p style="font-size: 18px; font-weight: 700">ä¸Šæµ·å¸‚ç–«æƒ…é˜²æ§æ ¸é…¸ç­›æŸ¥ä¸“ç­è´Ÿè´£äººå¤ç§‘å®¶è¡¨ç¤ºï¼Œå¯¹äºâ€œå¸¸æ€åŒ–æ£€æµ‹ç‚¹ä¸æ¥å—æ ¸é…¸æŠ¥å‘Šè¶…è¿‡72å°æ—¶â€çš„è¯´æ³•ï¼Œå¸‚é˜²æ§åŠæ²¡æœ‰å‡ºå°è¿‡æ­¤ç±»è¦æ±‚ï¼Œæˆ‘ä»¬å·²è¦æ±‚å„åŒºå¼€å±•è‡ªæŸ¥ï¼Œå¦‚æœ‰ä¸ªåˆ«é‡‡æ ·ç‚¹æ“…è‡ªåŠ ç ï¼Œå¿…é¡»åšå†³æ•´æ”¹ã€‚å¦å¤–éœ€è¦è¯´æ˜ä¸€ä¸‹ï¼Œå¤§å®¶å‡ºå…¥å±…ä½çš„æœ¬ç¤¾åŒºï¼Œä¸éœ€è¦æä¾›72å°æ—¶å†…æ ¸é…¸é˜´æ€§è¯æ˜ã€‚ä½†æ˜¯éœ€è¦è§„èŒƒä½©æˆ´å£ç½©ï¼Œé…åˆæµ‹æ¸©ï¼Œå¹¶ä¸»åŠ¨æ‰«å‡ºå…¥å£çš„â€œåœºæ‰€ç â€ï¼Œå‡ºç¤ºâ€œéšç”³ç â€ç»¿ç ã€‚</p>
        </a-card>
        <a-card title="è¯„è®ºå±•ç¤ºå†…å®¹" :bordered="false" :style="{ marginBottom: '24px',height:'595px'}">
          <a-list item-layout="horizontal" :data-source="data">
            <a-list-item slot="renderItem" slot-scope="item">
              <a-list-item-meta
                  :description="item.content"
              >
                <a slot="title" href="https://www.antdv.com/">{{ item.title }}</a>
                <a-avatar
                    slot="avatar"
                    :src="item.avatar"
                />
              </a-list-item-meta>
            </a-list-item>
          </a-list>
        </a-card>
      </a-col>
      <a-col :sm="24" :md="24" :xl="18" :style="{ marginBottom: '24px' }">
        <a-card title="åšæ–‡è¯„è®ºæƒ…æ„Ÿåˆ†å¸ƒ" :bordered="false" >
<!--          <p>è¯„è®ºç±»å‹</p>-->
          <div id="container">
            <div id="container1"></div>
            <div id="container2"></div>
          </div>
        </a-card>
      </a-col>
      <a-col :sm="24" :md="24" :xl="24" :style="{ marginBottom: '24px' }">
        <a-card title="å¾®åšåšæ–‡ä¸€çº§è½¬å‘åœ°å›¾ç¤ºæ„å›¾" :bordered="false">
<!--          <p>è½¬å‘åœ°å›¾å±•ç¤ºåŒºåŸŸ</p>-->
          <template v-slot:extra>
            <a-button type="primary" @click="onButtonClick" >
              æŸ¥çœ‹å…·ä½“
            </a-button>
          </template>
          <div id="map123" style="min-height: 500px; justify-content: center;position: relative"></div>
        </a-card>
      </a-col>
    </a-row>
  </div>
</template>

<script>
const data = [
  {
    title: 'æ—¶å°šä¸å¤å…¸ä¹‹é—´',
    content:'æ ¸é…¸æ£€æµ‹26ä¸ªå°æ—¶æ²¡å‡ºç»“æœçš„é£˜è¿‡ï¼',
    avatar:require('./../../../assets/conment/1 (1).jpg')
  },
  {
    title: 'walkingstopping',
    content:'æ¯å‘¨ä¸€æ¬¡æ€ä¹ˆå¤Ÿï¼Œæ·±åœ³æ²¡ç–«æƒ…éƒ½ä¸‰å¤©ä¸€æ¬¡ğŸ˜‚',
    avatar:require('./../../../assets/conment/1 (2).jpg')
  },
  {
    title: 'çœŸæ¨æ™“æ˜',
    content:'åšæŒå°±æ˜¯èƒœåˆ©âœŒ',
    avatar:require('./../../../assets/conment/1 (3).jpg')
  },
  {
    title: 'æ²¡æœ‰æ„Ÿæƒ…çš„é©¬å±å› ',
    content:'è¿˜åœ¨æå•Šâ€¦â€¦',
    avatar:require('./../../../assets/conment/1 (4).jpg')
  },
  {
    title: 'ALJ821003',
    content:'æµ¦ä¸œåŠ æ²¹å•Š',
    avatar:require('./../../../assets/conment/1 (5).jpg')
  },
  {
    title: 'wwè¥¿è¥¿å°å§',
    content:'è¿™æ˜¯å±è¯ ä»Šå¤©å»é“¶è¡Œæ ¹æœ¬ä¸ç®¡ç”¨',
    avatar:require('./../../../assets/conment/1 (6).jpg')
  },
  {
    title: 'åœåœå…ˆç”Ÿ',
    content:'ä¸ç®¡é˜´æ€§é˜³æ€§ï¼Œåªè¦åšäº†æ ¸é…¸å°±å¯ä»¥å‡ºé—¨ï¼Œè¿™ä¹ˆä¼šç©å—ï¼Ÿ',
    avatar:require('./../../../assets/conment/1 (7).jpg')
  },
];
import {mapState} from 'vuex'
import { Pie } from '@antv/g2plot';
import { Flow } from '@antv/l7plot';
import { Column} from '@antv/g2plot';
import { each, groupBy } from '@antv/util';
import reqwest from 'reqwest';
import infiniteScroll from 'vue-infinite-scroll';
const fakeDataUrl = 'https://randomuser.me/api/?results=5&inc=name,gender,email,nat&noinfo';
export default {
  directives: { infiniteScroll },
  name: 'TopicDetail',
  data() {
    return {
      data
    }
  },
  beforeMount() {

  },
  methods:{
    mountNode(){
      fetch('./data/pie.json  ')
          .then((data) => data.json())
          .then((data) => {
            const pieData = ((originData) => {
              const groupData = groupBy(originData, 'type');
              const result = [];
              each(groupData, (values, k) => {
                result.push({ type: k, value: values.reduce((a, b) => a + b.value, 0) });
              });
              return result;
            })(data);

            const pie = new Pie('container1', {
              data: pieData,
              colorField: 'type',
              angleField: 'value',
              label: { type: 'inner' },
              tooltip: false,
              state: {
                // è®¾ç½®ã€activeã€‘æ¿€æ´»çŠ¶æ€æ ·å¼ - æ— æè¾¹
                active: {
                  style: {
                    lineWidth: 0,
                  },
                },
              },
              interactions: [
                {
                  type: 'element-highlight',
                  cfg: {
                    showEnable: [{ trigger: 'element:mouseenter', action: 'cursor:pointer' }],
                    end: [
                      { trigger: 'element:mouseleave', action: 'cursor:default' },
                      { trigger: 'element:mouseleave', action: 'element-highlight:reset' },
                    ],
                  },
                },
              ],
            });

            const column = new Column('container2', {
              data,
              xField: 'city',
              yField: 'value',
              seriesField: 'type',
              isGroup: 'true',
              legend: false,
              columnStyle: {
                radius: [4, 4, 0, 0],
              },
            });

            pie.render();
            column.render();

            pie.on('element:mouseover', (evt) => {
              const eventData = evt.data;
              if (eventData?.data) {
                const type = eventData.data.type;
                column.setState('selected', (datum) => datum.type === type);
                column.setState('selected', (datum) => datum.type !== type, false);
              }
            });
            pie.on('element:mouseleave', () => {
              // å–æ¶ˆ selected é€‰ä¸­çŠ¶æ€
              column.setState('selected', () => true, false);
            });

            pie.on('element:click', (evt) => {
              const eventData = evt.data;
              if (eventData?.data) {
                const type = eventData.data.type;
                pie.chart.changeData(pieData.filter((datum) => datum.type === type));
                column.chart.changeData(data.filter((datum) => datum.type === type));
              }
            });
            // åŒå‡»ï¼Œè¿˜åŸæ•°æ®
            pie.on('element:dblclick', () => {
              pie.chart.changeData(pieData);
              column.chart.changeData(data);
            });
          });

    },
    forwardMap(){
      fetch('./data/forward_level1.json ')
          .then((response) => response.json())
          .then((data) => {
            new Flow('map123', {
              map: {
                type: 'amap',
                style: 'light',
                center: [116.3956, 39.9392],
                pitch: 0,
                zoom: 10,
              },
              source: {
                data: data,
                parser: {
                  type: 'json',
                  x: 'x1',
                  y: 'y1',
                  x1: 'x',
                  y1: 'y',
                },
              },
              autoFit: true,
              shape: 'arc',
              size: 1.5,
              color: {
                field: 'count',
                value: ['rgba(1,124,247,0.9)', 'rgba(230,129,28,0.9)'],
                scale: { type: 'quantize' },
              },
              style: {
                opacity: 0.8,
                segmentNumber: 60,
              },
              animate: {
                interval: 2,
                trailLength: 1,
                duration: 2,
              },
              radiation: {
                color: 'white',
                size: 30,
              },
              label: {
                visible: true,
                field: 'count',
                style: {
                  fill: '#000',
                  opacity: 0.8,
                  fontSize: 10,
                  stroke: '#fff',
                  strokeWidth: 2,
                  textAllowOverlap: false,
                  padding: [5, 5],
                  textOffset: [0, 35],
                },
              },
              zoom: {
                position: 'bottomright',
              },
              scale: {
                position: 'bottomright',
              },
              layerMenu: {
                position: 'topright',
              },
              legend: {
                position: 'bottomleft',
              },
            });
          });
    },
    fetchData(callback) {
      reqwest({
        url: fakeDataUrl,
        type: 'json',
        method: 'get',
        contentType: 'application/json',
        success: res => {
          callback(res);
        },
      });
    },
    handleInfiniteOnLoad() {
      const data = this.data;
      this.loading = true;
      if (data.length > 14) {
        this.$message.warning('Infinite List loaded all');
        this.busy = true;
        this.loading = false;
        return;
      }
      this.fetchData(res => {
        this.data = data.concat(res.results);
        this.loading = false;
      });
    },
    onButtonClick(){
      this.$router.push('/context/repostImage')
    }
  },
  computed: {
    ...mapState('setting', ['pageMinHeight']),
  },
  mounted() {
    this.forwardMap()
    this.mountNode()

  }
}
</script>

<style scoped lang="less">
@import "../index.less";
.demo-infinite-container {
  border: 1px solid #e8e8e8;
  border-radius: 4px;
  overflow: auto;
  padding: 8px 24px;
  min-height: 300px;
}
.demo-loading-container {
  position: absolute;
  bottom: 40px;
  width: 100%;
  text-align: center;
}
#container {
  display: flex;
  flex-direction: column !important;
  padding: 8px;
}
#container1,#container2 {
  flex: 1;
}
</style>
